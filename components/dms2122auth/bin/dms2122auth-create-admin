#!/usr/bin/env python3

from components.dms2122auth.dms2122auth.data.db.exc.userexistserror import UserExistsError
from dms2122common.data import Role
from dms2122auth.data.config import AuthConfiguration
from dms2122auth.data.db import Schema
from dms2122auth.service import UserServices, RoleServices

try:

    cfg: AuthConfiguration = AuthConfiguration()
    cfg.load_from_file(cfg.default_config_file())
    db: Schema = Schema(cfg)
    UserServices.create_user("admin", "admin", db, cfg)
    RoleServices.grant_role("admin", Role.Admin, db)
except UserExistsError:
    print("Admin Already Exists, continue", flush=True)
except Exception:
    print("Unknown error while creating the Admin account, continue", flush=True)
